<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.idata365.app.mapper.InteractTempCarMapper">
    <resultMap id="BaseTempCarMap" type="com.idata365.app.entity.InteractTempCar" >
    </resultMap>
 
      <update id="lockCar"  parameterType="com.idata365.app.entity.InteractTempCar">
       update  interactAirdrop a,(   
       select id,rand() r from interactTempCar
       where daystamp=#{daystamp} and lockStatus=1 and type>0 order by r limit 5) b
	   set  a.lockBatchId=#{lockBatchId},a.stealerId=#{stealerId},a.lockStatus=-1,
       a.lockTime=#{lockTime}  where a.id=b.id
     </update>
    
     <select id="getTempCar" resultMap="BaseTempCarMap" parameterType="java.lang.String">
      select a.*,b.nickName as driver from ( SELECT  *
       		FROM  interactTempCar  where lockBatchId=#{uuid}) a left join 
       		usersAccount b on a.userId=b.id
     </select>
     
      <insert id="batchInsertCar" parameterType="java.util.HashMap">
      INSERT INTO  interactTempCar
		 (userId,carId,powerNum,carType,type,travelId,daystamp,createTime,uuid,lockStatus)
		  VALUES
    	<foreach collection="list" item="item" index="index" separator=",">
    		(#{item.userId},#{item.carId},#{item.power},#{item.carType},#{item.type},
    		'0',#{item.daystamp},now(),#{item.uuid},-1) 
    	</foreach>
    	</insert>

      <update id="updateTempCar"  parameterType="java.util.HashMap">
       update  interactTempCar set hadGet=1,lockStatus=2,
       stealerId=#{stealerId} where hadGet=0,lockStatus=-1, and uuid=#{uuid}
     </update>
      <select id="getTempCarByUuid" resultMap="BaseTempCarMap" parameterType="java.lang.String">
      select *
       		FROM  interactTempCar  where uuid=#{uuid} 
     </select>
     <update id="updateBlackIds"  parameterType="java.util.HashMap">
       update  interactTempCar set blackIds=CONCAT(blackIds,#{blackIds})
         where travelId=#{uuid}
     </update>
     
     <select id="isCanStealPower" >
      	select count(1) from interactTempCar where userId=#{userId} and type=1 and lockStatus=1
     </select>
</mapper>